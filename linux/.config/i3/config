# i3 config file (v4)
# Please see https://i3wm.org/docs/userguide.html for a complete reference

focus_follows_mouse no

# Set mod key (Mod4=Super/Windows key)
set $hyp Mod1+Shift+Control+Mod4
set $altc Mod1+Control
set $alt Mod1
set $mod Mod4

# Font for window titles
font pango:JetBrainsMono Nerd Font 10 

# Use Mouse+$mod to drag floating windows
floating_modifier $mod

# ========== ALL KEYBINDINGS (organized to prevent conflicts) ==========

# CORE WINDOW MANAGEMENT
bindsym $hyp+q kill
bindsym $hyp+f fullscreen toggle
bindsym $hyp+g floating toggle

# FOCUS MOVEMENT (hjkl vim-style)
bindsym $hyp+h focus left
bindsym $hyp+j focus down
bindsym $hyp+k focus up
bindsym $hyp+l focus right

# WINDOW MOVEMENT
bindsym $altc+h move left
bindsym $altc+j move down
bindsym $altc+k move up
bindsym $altc+l move right

# APPLICATION LAUNCHERS
bindsym $hyp+t exec kitty
bindsym $hyp+b exec thorium-browser
bindsym $hyp+a exec rofi -show drun
bindsym $hyp+Tab exec rofi -show window
bindsym $hyp+e exec kitty -e yazi

# WORKSPACE SWITCHING (numbers)
bindsym $hyp+1 workspace $ws1
bindsym $hyp+2 workspace $ws2
bindsym $hyp+3 workspace $ws3
bindsym $hyp+4 workspace $ws4
bindsym $hyp+5 workspace $ws5
bindsym $hyp+6 workspace $ws6
bindsym $hyp+7 workspace $ws7
bindsym $hyp+8 workspace $ws8
bindsym $hyp+9 workspace $ws9
bindsym $hyp+0 workspace $ws10

# WORKSPACE MOVEMENT (ctrl + numbers)
bindsym $altc+1 move container to workspace $ws1
bindsym $altc+2 move container to workspace $ws2
bindsym $altc+3 move container to workspace $ws3
bindsym $altc+4 move container to workspace $ws4
bindsym $altc+5 move container to workspace $ws5
bindsym $altc+7 move container to workspace $ws7
bindsym $altc+8 move container to workspace $ws8
bindsym $altc+9 move container to workspace $ws9
bindsym $altc+0 move container to workspace $ws10

# SPECIAL WORKSPACES
bindsym $mod+ctrl+a workspace $wsart
bindsym $mod+grave workspace back_and_forth

# SCREENSHOTS
bindsym $hyp+s exec flameshot full -c

# SYSTEM MANAGEMENT
bindsym $alt+r restart
bindsym $alt+q exec "i3-nagbar -t warning -m 'Exit i3?' -B 'Yes' 'i3-msg exit'"
bindsym $altc+x exec "i3lock -i ~/.config/i3/lockscreen.png && systemctl suspend"

# CANVAS MODE (your existing custom functionality)
bindsym $hyp+w exec ~/dotfiles/scripts/canvas-mode.sh toggle

# ========== RESIZE MODE ==========
mode "resize" {
    bindsym h resize shrink width 10 px or 10 ppt
    bindsym j resize grow height 10 px or 10 ppt
    bindsym k resize shrink height 10 px or 10 ppt
    bindsym l resize grow width 10 px or 10 ppt
    
    # Back to normal
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym $mod+r mode "default"
}

# ========== MOVE MODE ==========
mode "move" {
    # Move window to different positions in workspace
    bindsym h move left 30 px
    bindsym j move down 30 px
    bindsym k move up 30 px
    bindsym l move right 30 px
    
    # Faster movement
    bindsym shift+h move left 100 px
    bindsym shift+j move down 100 px
    bindsym shift+k move up 100 px
    bindsym shift+l move right 100 px
    
    # BSP-like positioning shortcuts
    bindsym Left move position 0 0
    bindsym Right move position 50 ppt 0
    bindsym Up move position 0 0
    bindsym Down move position 0 50 ppt
    bindsym c move position center
    
    # Move to screen edges/corners
    bindsym ctrl+h move position 0 center
    bindsym ctrl+l move position 100 ppt center
    bindsym ctrl+k move position center 0
    bindsym ctrl+j move position center 100 ppt
    
    # Corner positions
    bindsym 1 move position 0 0
    bindsym 2 move position 50 ppt 0
    bindsym 3 move position 100 ppt 0
    bindsym 4 move position 0 50 ppt
    bindsym 5 move position center
    bindsym 6 move position 100 ppt 50 ppt
    bindsym 7 move position 0 100 ppt
    bindsym 8 move position 50 ppt 100 ppt
    bindsym 9 move position 100 ppt 100 ppt
    
    # Back to normal
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym $mod+shift+m mode "default"
}

# ========== WORKSPACE DEFINITIONS ==========
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10"
set $wsart "art"

# ========== WINDOW RULES ==========

# Always use split container mode by default (more like bspwm's binary tree)
for_window [class=".*"] split toggle

# Art application window rules
for_window [class="krita"] floating disable
for_window [class="krita" title=".*Docker.*"] floating enable, sticky enable
for_window [class="Blender"] floating disable  
for_window [class="Gimp"] floating disable
for_window [class="Gimp" window_type="dialog"] floating enable

# Float certain windows by default
for_window [class="pavucontrol"] floating enable
for_window [class="Blueman-manager"] floating enable
for_window [class="Nm-connection-editor"] floating enable
for_window [class="Lxappearance"] floating enable
for_window [class="Arandr"] floating enable
for_window [title="Picture-in-Picture"] floating enable, sticky enable
for_window [class="feh"] floating enable
for_window [class="Sxiv"] floating enable
for_window [class="mpv"] floating enable
for_window [window_role="pop-up"] floating enable
for_window [window_role="task_dialog"] floating enable
for_window [title="Preferences$"] floating enable
for_window [class="floating-terminal"] floating enable, resize set 800 600, move position center

# Make ripdrag windows floating
for_window [class="ripdrag"] floating enable
for_window [class="ripdrag"] resize set 300 400
for_window [class="ripdrag"] move position center

# Center floating windows
for_window [floating] move position center

# Focus new windows
for_window [class="Thorium"] focus
for_window [class="kitty"] focus
for_window [class="Code"] focus

# Urgent window handling
for_window [urgent=latest] focus

# ========== WORKSPACE ASSIGNMENTS ==========
assign [class="krita"] $wsart
assign [class="Blender"] $wsart
assign [class="Gimp"] $wsart
assign [class="thunderbird"] $ws9
assign [class="discord"] $ws10
assign [class="Spotify"] $ws10

# ========== APPEARANCE ==========

# i3-gaps settings (minimalist rice aesthetic)
gaps inner 5
gaps outer 3
smart_gaps inverse_outer
default_border pixel 4
default_floating_border pixel 4
hide_edge_borders none

# Color settings (Kanagawa theme)
# class                 border  backgr. text    indicator child_border
client.focused          #C8C8C8 #1F1F28 #DCD7BA #C8C8C8   #C8C8C8
client.focused_inactive #223249 #223249 #DCD7BA #223249   #223249
client.unfocused        #1F1F28 #1F1F28 #727169 #1F1F28   #1F1F28
client.urgent           #C34043 #C34043 #DCD7BA #C34043   #C34043

# ========== STATUS BAR ==========
bar {
    position top
    status_command i3blocks
    
    colors {
        background #1d2021
        statusline #ebdbb2
        separator  #665c54
        
        # class            border  backgr. text
        focused_workspace  #458588 #458588 #ebdbb2
        active_workspace   #83a598 #83a598 #ebdbb2
        inactive_workspace #1d2021 #1d2021 #a89984
        urgent_workspace   #cc241d #cc241d #ebdbb2
    }
    
    font pango:JetBrains Mono 9
}

# ========== DISPLAY CONFIGURATION ==========

# Single monitor setup (primary configuration)
exec_always --no-startup-id "xrandr --output DP-0 --primary --mode 3840x2160 --rate 239.99 --pos 0x0 --rotate normal"

# ========== AUTOSTART APPLICATIONS ==========

# Essential services
exec_always --no-startup-id "picom --config ~/.config/picom/picom-minimal.conf"
exec_always --no-startup-id "feh --bg-scale ~/wallpaper.jpg"
exec --no-startup-id "dunst"

# System tray applications
exec --no-startup-id "nm-applet"
exec --no-startup-id "blueman-applet"
exec --no-startup-id "pasystray"

# Additional services
exec --no-startup-id "redshift-gtk"
exec --no-startup-id "flameshot"
exec --no-startup-id "xss-lock -- i3lock -i ~/.config/i3/lockscreen.jpg"

# Auto-lock after inactivity
exec --no-startup-id "xset s 300 300"
exec --no-startup-id "xset dpms 600 900 1200"
